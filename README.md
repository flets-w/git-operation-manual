# リポジトリ 運用ルール

> [!NOTE]
> 🔨 運用ルールは編集中です
<br>
このリポジトリは、チームで GitHub を安全かつ効率的に運用するためのドキュメントを管理することを目的としています。全員がこのドキュメントを参照し、以下のルールを必ず遵守してください。<br>
イメージ図を[こちら](./Overview.md)でまとめていますので併せてご活用ください。
<br>
<br>

## 目次
- [ブランチ戦略](#branch)
- [作業の流れ](#flow)
- [命名規則](#naming)
- [Pull Request（プルリクエスト）とレビューのルール](#pr-review)
- [サブ環境について](#staging)
- [やってはいけないこと（禁止事項）](#forbidden)
- [コンフリクト解決時の禁止事項](#conflict)
<br>
<br>

---
<a id="branch"></a>
## 1. ブランチ戦略
<details>
<summary>&nbsp;</summary>

当リポジトリでは、主に 3 種類のブランチを使用して開発を進めます。

- **`main` ブランチ**

  - **役割:** **サブ環境および本番環境の元となる**、常に安定した最新のコードを保持するブランチです。このブランチの状態が常に「正」となります。
  - **ルール:** このブランチへの直接の push は**絶対に禁止**です。変更は必ず`dev`ブランチからの Pull Request を通じて行われます。

- **`dev` ブランチ**

  - **役割:** 全ての作業ブランチを統合し、レビューするためのブランチです。`main`ブランチにマージする前の、一時的なまとめ場所として機能します。**このブランチのファイルが直接サーバーにアップロードされることはありません。**
  - **このリポジトリのデフォルトブランチです。**
  - **ルール:** このブランチへの直接の push は**禁止**です。

- **作業ブランチ**
  - **役割:** 個別の修正や機能追加など、具体的な作業を行うためのブランチです。
  - **ルール:** 必ず`dev`ブランチから作成してください。ブランチの命名については「命名規則」のセクションを参照ください。

</details>


---
<a id="flow"></a>
## 2. 作業の流れ

<details>
<summary>&nbsp;</summary>

基本的な開発・修正作業は、以下の流れに沿って行ってください。<br>
作業の流れのイメージ図は[こちら](./Overview.md#作業の流れ)

1. **初回セットアップ（リポジトリ取得）**  
   - 初めて clone する場合は、容量削減のため sparse checkout を利用してください。  
     ```bash
     git clone --filter=blob:none --sparse <REPO_URL>
     cd <REPO_DIR>
     ```
     <br>

     > 💡 **TIP:** 上記の設定は初回 clone 時だけで OK です。続けて下記を設定してください。
     
     <br>
     
   - **ディレクトリ単位で取得する場合**  
     ```bash
     git sparse-checkout init --cone
     git sparse-checkout set flets/user
     ```
   - **ファイル単位で取得する場合（例）**  
     ```bash
     git sparse-checkout set --no-cone \
       flets/user/index.html \
       flets/user/confirm/index.html \
       flets/user/**/*.css
     ```
     

2. **作業ブランチの準備**  
   - 既に clone 済みの場合、まず最新の `dev` を取得します。  
     ```bash
     git pull origin dev
     ```
   - そこから命名規則に従い作業ブランチを作成します。（例: `update/top-page-text`）  
     ```bash
     git checkout -b update/xxx
     ```

3. **作業とコミット**  
   - ファイルを編集後、必ず `git status` で変更内容を確認してください。  
   - 不要なファイルが含まれる場合は `git reset` や `.gitignore` を見直して除外します。  
   - 問題なければコミットします。  
     ```bash
     git add .
     git commit -m "作業内容を明確に記載（例: update banner image）"
     ```

4. **Push と Pull Request**  
   - 作業ブランチをリモートへ push します。  
     ```bash
     git push origin update/xxx
     ```
   - 初回 push の場合は新規 Pull Request を作成、既存 PR がある場合は push した内容が自動的に反映されます。  

5. **レビューと修正対応**  
   - PR を作成したらレビューを依頼します。  
   - 修正要求があった場合は同じブランチで修正して push し直してください（PR は取り下げない）。  

6. **マージとクリーンアップ**  
   - 承認後は **Squash and merge** で `dev` に統合します。  
   - 作業完了後、不要になった作業ブランチは削除してください。  

7. **サブ環境・本番反映**  
   - `dev` → `main` の PR を責任者が承認後、`main` をサブ環境に FTP アップロードして確認。  
   - 問題なければ同じ内容を本番環境へ反映します。

   <br>

　 ⚠️ **注意:** ここの運用は要相談

  <br>
  
</details>

---
<a id="naming"></a>
## 3. 命名規則

<details>
<summary>&nbsp;</summary>

作業の目的を明確にするため、ブランチの命名には以下の接頭辞を必ず使用してください。<br>
命名規則のイメージ図は[こちら](./Overview.md#ブランチ命名規則イメージ)

- ### `update/`

  - **用途:** 既存の文言修正、画像差し替え、情報の更新など、**不具合以外の一般的な修正・更新作業**に使用します。
  - **例:** `update/banner-image`, `update/news-text-20250820`

- ### `feature/`

  - **用途:** 新しいページや、これまで無かった新しい機能を追加する**新規開発作業**に使用します。
  - **例:** `feature/add-contact-form`

- ### `fix/`
  - **用途:** プログラムのエラーなど、**明確な不具合（バグ）を修正する作業**に使用します。主に js 関連はこちらを使用
  - **例:** `fix/header-link-error`

</details>

---
<a id="pr-review"></a>
## 4. Pull Request (プルリクエスト) とレビューのルール

<details>
<summary>&nbsp;</summary>

- `main`および`dev`ブランチへの変更は、必ず Pull Request を通じて行います。
- 全ての Pull Request は、作成者以外の**最低 1 名の承認（Approve）**がなければマージできません。（このルール設定は無料版では不可なので、将来的に設定します）
- レビューで指摘された点（Conversation）は、全て解決済み（Resolved）にしてください。
- マージの際は、必ず **Squash and merge** を選択してください。これにより、`dev`や`main`の履歴がクリーンに保たれます。
  
</details>

---
<a id="staging"></a>
## 5. サブ環境について

<details>
<summary>&nbsp;</summary>
  
- **サブ環境:** `main`ブランチの最新の内容を、手動で FTP アップロードします。

</details>

---
<a id="forbidden"></a>
## 6. ⚠️ やってはいけないこと（禁止事項）

<details>
<summary>&nbsp;</summary>

GitHub での運用を安全かつ効率的に進めるため、以下の行動は絶対に避けてください。
これらのルールを守らないと、コードの混入やコンフリクト（競合）など、重大な事故につながる可能性があります。

- **`main` および `dev` ブランチへの直接のプッシュ**
  `main`と`dev`ブランチへの変更は、必ず Pull Request（プルリク）を通じて行ってください。ローカルでの直接プッシュは、コードレビューや承認のプロセスをスキップし、本番環境のコードに予期せぬ変更をもたらすリスクがあります。

- **`git pull` をせずに作業ブランチを作成する**
  常に最新の `dev` ブランチから作業ブランチを作成する必要があります。`git pull` をせずに作業を始めると、他のメンバーの最新の変更が含まれず、後で大きなコンフリクト（競合）が発生する原因となります。

- **`git status` を確認せずにコミット・プッシュする**
  `git add` や `git commit` を実行する前に、必ず `git status` で変更内容を確認してください。意図しないファイル（ローカルの設定ファイルなど）がコミットされるのを防ぎます。

- **ローカルでコンフリクトを未解決のままマージする**
  `git pull` を実行した際にコンフリクトが発生した場合、解決せずに放置したり、無理にマージしたりしないでください。必ずコンフリクトを丁寧に解消し、意図した通りの変更になっているか確認してからコミットしてください。

- **プルリクエストのレビューを省略する**
  どのような小さな変更であっても、PR のレビューは必須です。これは、人為的なミスを防ぎ、チーム全体の品質を保つための最も重要な安全策です。

- **コミットメッセージを適当に書く**
  変更内容が曖昧なコミット（例: "fix", "update", "修正"など）は、後から履歴を追う際に混乱を招き、問題発生時の原因究明を困難にします。コミットメッセージには「何のために、何を、どう変更したか」を明確に記載してください。

</details>

---
<a id="conflict"></a>
## 7. ⚠️ コンフリクト解決時の禁止事項

<details>
<summary>&nbsp;</summary>

コンフリクトにいて以下のルールを遵守し、チームの安全と生産性を保ってください。
これらのルールを守らないと、他メンバーの作業内容を誤って削除したり、不具合の原因となるコードを混入させたりする可能性があります。

- **コンフリクトを放置しない**
  コンフリクトが発生したら、速やかにチームに報告してください。一人で悩まず、他のメンバーに相談し、協力して解決にあたることが重要です。

- **相手の変更を無条件に上書きしない**
  コンフリクトの解決は、単にどちらかの変更を残すことではありません。なぜコンフリクトが発生したかを理解し、両方の変更が正しく反映されるようにコードを修正してください。

- **不完全な状態でコミットしない**
  解決したはずのファイルに`<<<<<<<`や`=======`といった Git のマークアップが残っていないか、必ず最終確認を行ってください。不完全な状態のコードをプッシュすると、後続の作業に大きな影響を与えます。

</details>

